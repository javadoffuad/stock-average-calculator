import{a as P,c as h}from"./chunk-DFRLWWFT.js";import{Ob as O,Pb as a,Qb as T,Ra as c,Rb as w,Sb as v,ab as d,da as m,dc as l,ec as S,gc as j,ia as r,tb as _,ub as U,vb as M,wa as u,wb as s,xb as p,yb as f}from"./chunk-FEEDRQDZ.js";function k(t,e){let o=typeof t=="string"?parseInt(t,10):t,i=(Math.sign(o)||1)*Math.abs(e)/1e9;return o+i}var g=class t{position=j.required();combinePrice=k;static \u0275fac=function(o){return new(o||t)};static \u0275cmp=d({type:t,selectors:[["app-position-item"]],inputs:{position:[1,"position"]},decls:15,vars:12,consts:[[1,"position"],[1,"logo"],[1,"content"],[1,"name"],[1,"current-price"],[1,"price"]],template:function(o,n){if(o&1&&(s(0,"div",0),f(1,"div",1),s(2,"div",2)(3,"h3",3),a(4),p(),s(5,"div")(6,"span"),a(7),p(),s(8,"span",4),a(9),p()()(),s(10,"div",5)(11,"div"),a(12),p(),s(13,"div"),a(14),p()()()),o&2){let i=n.position(),D=n.combinePrice(i.currentPrice.units,i.currentPrice.nano),R=n.combinePrice(i.averagePositionPrice.units,i.averagePositionPrice.nano),y=n.combinePrice(i.expectedYield.units,i.expectedYield.nano),C=i.currentPrice.currency;c(4),T(i.ticker),c(3),w("",i.quantity.units," \u0448\u0442."),c(2),v("",D," ",C),c(3),v("",R," ",C),c(),O("expected-yield_red",y<0)("expected-yield_green",y>0),c(),v("",y," ",C)}},styles:[".position[_ngcontent-%COMP%]{display:flex;align-items:center;flex-flow:row;width:100%;padding:10px;border-bottom:1px solid #919191;gap:10px}.name[_ngcontent-%COMP%]{font-size:15px}.logo[_ngcontent-%COMP%]{display:flex;width:44px;height:44px;border-radius:50%;background:#919191}.content[_ngcontent-%COMP%]{display:flex;flex-flow:column;flex-grow:1}.price[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:flex-end}.current-price[_ngcontent-%COMP%]{margin-left:8px}.expected-yield_red[_ngcontent-%COMP%]{color:#dc143c}.expected-yield_green[_ngcontent-%COMP%]{color:#228b22}"]})};var x="https://invest-public-api.tinkoff.ru/rest/tinkoff.public.invest.api.contract.v1";var I=class t{serviceUrl=`${x}.UsersService/`;http=r(P);authService=r(h);accounts=u([]);currentAccount=l(()=>this.accounts().length?this.accounts()[0]:null);constructor(){}loadAccounts(){this.http.post(`${this.serviceUrl}GetAccounts`,{status:"ACCOUNT_STATUS_UNSPECIFIED"},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.authService.getAccessToken()}`}}).subscribe(e=>this.accounts.set(e.accounts))}static \u0275fac=function(o){return new(o||t)};static \u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"})};var b=class t{serviceUrl=`${x}.OperationsService/`;http=r(P);authService=r(h);portfolio=u(null);selectPortfolio=l(()=>this.portfolio());constructor(){}loadPortfolio(e,o="RUB"){this.http.post(`${this.serviceUrl}GetPortfolio`,{accountId:e,currency:o},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.authService.getAccessToken()}`}}).subscribe(n=>this.portfolio.set(n))}static \u0275fac=function(o){return new(o||t)};static \u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"})};var N=(t,e)=>e.ticker;function F(t,e){if(t&1&&f(0,"app-position-item",0),t&2){let o=e.$implicit;M("position",o)}}var E=class t{usersService=r(I);operationsService=r(b);account=this.usersService.currentAccount;portfolio=this.operationsService.selectPortfolio;positions=l(()=>this.portfolio()?.positions);positionShares=l(()=>this.positions()?.filter(e=>e.instrumentType==="share"));constructor(){S(()=>{let e=this.account();console.log("account",e),e&&this.operationsService.loadPortfolio(e.id)}),S(()=>{console.log("operation",this.portfolio())})}ngOnInit(){this.usersService.loadAccounts()}static \u0275fac=function(o){return new(o||t)};static \u0275cmp=d({type:t,selectors:[["app-positions"]],decls:4,vars:0,consts:[[3,"position"]],template:function(o,n){o&1&&(s(0,"h2"),a(1,"\u0410\u043A\u0446\u0438\u0438"),p(),_(2,F,1,1,"app-position-item",0,N)),o&2&&(c(2),U(n.positionShares()))},dependencies:[g],encapsulation:2})};export{E as PositionsComponent};

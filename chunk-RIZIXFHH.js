import{a as I}from"./chunk-S3CE4ME5.js";import{d as m}from"./chunk-2T6ESY2B.js";import{C as g,M as l,a as f,b as P,fa as r,ka as s,oc as n,ya as a}from"./chunk-HWLOXOEQ.js";var d=class i{http=s(m);serviceUrl=`${I}.OperationsService/`;constructor(){}loadPortfolio(t,e="RUB"){return this.http.post(`${this.serviceUrl}GetPortfolio`,{accountId:t,currency:e})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})};var v=class i{operationsService=s(d);portfolio=a(null);isLoading=a({});selectPortfolio=n(()=>this.portfolio());selectPositions=n(()=>this.portfolio()?.positions);selectPositionBy=t=>n(()=>this.selectPositions()?.find(e=>e.ticker===t)??null);selectIsLoading=n(()=>Object.values(this.isLoading()).some(Boolean));loadPortfolio(t){this.isLoading.set({[t]:!0}),this.operationsService.loadPortfolio(t).pipe(l(1)).subscribe({error:()=>{this.isLoading.set({[t]:!1})},next:e=>{this.portfolio.set(e),this.isLoading.set({[t]:!1})}})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})};var S=class i{storeOperationsService=s(v);constructor(){}loadPortfolio(t){this.storeOperationsService.loadPortfolio(t)}selectPortfolio(){return this.storeOperationsService.selectPortfolio}selectPositions(){return this.storeOperationsService.selectPositions}selectPositionBy(t){return this.storeOperationsService.selectPositionBy(t)}selectIsLoading(){return this.storeOperationsService.selectIsLoading}static \u0275fac=function(e){return new(e||i)};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})};var y=class i{http=s(m);serviceUrl=`${I}.InstrumentsService/`;instruments=a({});selectInstruments=n(()=>Object.values(this.instruments()).filter(t=>!!t));constructor(){}selectInstrumentBy(t){return this.instruments()[t]}loadShareBy(t,e="INSTRUMENT_ID_TYPE_UID",c=""){t&&this.http.post(`${this.serviceUrl}ShareBy`,{idType:e,id:t,classCode:c}).pipe(l(1)).subscribe(p=>{this.instruments.update(o=>P(f({},o),{[p.instrument.uid]:p.instrument}))})}loadSharesBy(t){if(!t.length)return;let e=this.selectInstruments().map(({uid:o})=>o),p=t.filter(o=>!e.includes(o)).map(o=>this.loadShare(o));g(p).pipe(l(1)).subscribe(o=>{let h={};for(let{instrument:u}of o)h[u.uid]=u;this.instruments.update(u=>f(f({},u),h))})}loadShare(t,e="INSTRUMENT_ID_TYPE_UID",c=""){return this.http.post(`${this.serviceUrl}ShareBy`,{idType:e,id:t,classCode:c})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})};export{S as a,y as b};

import{a as l}from"./chunk-S3CE4ME5.js";import{d as u}from"./chunk-2T6ESY2B.js";import{C as A,M as p,a as v,b as O,fa as o,ka as i,oc as s,x as P,ya as c}from"./chunk-HWLOXOEQ.js";var d=class e{http=i(u);serviceUrl=`${l}.OperationsService/`;constructor(){}loadPortfolio(t,r="RUB"){return this.http.post(`${this.serviceUrl}GetPortfolio`,{accountId:t,currency:r})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})};var b=class e{http=i(u);serviceUrl=`${l}.InstrumentsService/`;loadShareBy(t,r="INSTRUMENT_ID_TYPE_UID",m=""){return this.http.post(`${this.serviceUrl}ShareBy`,{idType:r,id:t,classCode:m})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})};var S=class e{serviceUrl=`${l}.UsersService/`;http=i(u);loadAccounts(){return this.http.post(`${this.serviceUrl}GetAccounts`,{status:"ACCOUNT_STATUS_UNSPECIFIED"}).pipe(P(t=>t.accounts))}getInfo(){return this.http.post(`${this.serviceUrl}GetInfo`,{})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})};var h=class e{operationsService=i(d);portfolio=c(null);isLoading=c({});selectPortfolio=s(()=>this.portfolio());selectPositions=s(()=>this.portfolio()?.positions);selectPositionBy=t=>s(()=>this.selectPositions()?.find(r=>r.ticker===t)??null);loadPortfolio(t){this.isLoading.set({[t]:!0}),this.operationsService.loadPortfolio(t).pipe(p(1)).subscribe({error:()=>{this.isLoading.set({[t]:!1})},next:r=>{this.portfolio.set(r),this.isLoading.set({[t]:!1})}})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})};var E=class e{storeOperationsService=i(h);selectPortfolio=this.storeOperationsService.selectPortfolio;selectPositions=this.storeOperationsService.selectPositions;selectPositionBy(t){return this.storeOperationsService.selectPositionBy(t)}loadPortfolio(t){this.storeOperationsService.loadPortfolio(t)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})};var g=class e{instrumentsService=i(b);instruments=c({});selectInstruments=s(()=>Object.values(this.instruments()).filter(t=>!!t));selectInstrumentBy(t){return this.instruments()[t]}loadShareBy(t,r="INSTRUMENT_ID_TYPE_UID",m=""){t&&this.instrumentsService.loadShareBy(t,r,m).pipe(p(1)).subscribe(f=>{this.instruments.update(n=>O(v({},n),{[f.instrument.uid]:f.instrument}))})}loadSharesBy(t){if(!t.length)return;let r=this.selectInstruments().map(({uid:n})=>n),f=t.filter(n=>!r.includes(n)).map(n=>this.instrumentsService.loadShareBy(n));A(f).pipe(p(1)).subscribe(n=>{let U={};for(let{instrument:I}of n)U[I.uid]=I;this.instruments.update(I=>v(v({},I),U))})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})};var y=class e{storeInstrumentsService=i(g);selectInstruments=this.storeInstrumentsService.selectInstruments;selectInstrumentBy(t){return this.storeInstrumentsService.selectInstrumentBy(t)}loadShareBy(t){this.storeInstrumentsService.loadShareBy(t)}loadSharesBy(t){this.storeInstrumentsService.loadSharesBy(t)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})};var R=class e{usersService=i(S);accounts=c([]);info=c(null);currentAccount=s(()=>this.accounts().length?this.accounts()[0]:null);currentInfo=s(()=>this.info());currentCommission=s(()=>{let t=this.currentInfo()?.tariff;return t?this.getCommission(t):null});loadAccounts(){this.usersService.loadAccounts().subscribe(t=>this.accounts.set(t))}getInfo(){this.usersService.getInfo().subscribe(t=>this.info.set(t))}getCommission(t){switch(t){case"investor":return{bond:.3,share:.3,etf:.3,futures:.1,currency:.9,preciousMetals:1.9};case"trader":return{bond:.05,share:.05,etf:.05,futures:.04,currency:.5,preciousMetals:1.5};case"premium":return{bond:.04,share:.04,etf:.04,futures:.04,currency:.5,preciousMetals:.9};default:return null}}static \u0275fac=function(r){return new(r||e)};static \u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})};var N=class e{storeUsersService=i(R);selectCurrentAccount=this.storeUsersService.currentAccount;selectCommission=this.storeUsersService.currentCommission;loadAccounts(){this.storeUsersService.loadAccounts()}getInfo(){this.storeUsersService.getInfo()}static \u0275fac=function(r){return new(r||e)};static \u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})};export{E as a,y as b,N as c};

import{a as I}from"./chunk-S3CE4ME5.js";import{d as m}from"./chunk-43IZR5HA.js";import{C as b,M as f,a as c,b as h,fa as p,ka as u,pc as s,ya as a}from"./chunk-LK5URRF6.js";var v=class i{http=u(m);serviceUrl=`${I}.OperationsService/`;portfolio=a(null);selectPortfolio=s(()=>this.portfolio());selectPositionBy=t=>s(()=>this.portfolio()?.positions.find(r=>r.ticker===t)??null);constructor(){}loadPortfolio(t,r="RUB"){this.http.post(`${this.serviceUrl}GetPortfolio`,{accountId:t,currency:r}).subscribe(n=>this.portfolio.set(n))}static \u0275fac=function(r){return new(r||i)};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})};var y=class i{http=u(m);serviceUrl=`${I}.InstrumentsService/`;instruments=a({});selectInstruments=s(()=>Object.values(this.instruments()).filter(t=>!!t));constructor(){}selectInstrumentBy(t){return this.instruments()[t]}loadShareBy(t,r="INSTRUMENT_ID_TYPE_UID",n=""){t&&this.http.post(`${this.serviceUrl}ShareBy`,{idType:r,id:t,classCode:n}).pipe(f(1)).subscribe(o=>{this.instruments.update(e=>h(c({},e),{[o.instrument.uid]:o.instrument}))})}loadSharesBy(t){if(!t.length)return;let r=this.selectInstruments().map(({uid:e})=>e),o=t.filter(e=>!r.includes(e)).map(e=>this.loadShare(e));b(o).pipe(f(1)).subscribe(e=>{let d={};for(let{instrument:l}of e)d[l.uid]=l;this.instruments.update(l=>c(c({},l),d))})}loadShare(t,r="INSTRUMENT_ID_TYPE_UID",n=""){return this.http.post(`${this.serviceUrl}ShareBy`,{idType:r,id:t,classCode:n})}static \u0275fac=function(r){return new(r||i)};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})};export{v as a,y as b};
